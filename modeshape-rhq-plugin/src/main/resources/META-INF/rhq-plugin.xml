<?xml version="1.0" encoding="UTF-8" ?>
    <!--
        /* 
         * ModeShape (http://www.modeshape.org)
         * See the COPYRIGHT.txt file distributed with this work for information
         * regarding copyright ownership. Some portions may be licensed
         * to Red Hat, Inc. under one or more contributor license agreements.
         * See the AUTHORS.txt file in the distribution for a full listing of
         * individual contributors.
         *
         * ModeShape is free software. Unless otherwise indicated, all code in
         * ModeShape is licensed to you under the terms of the GNU Lesser General Public License as
         * published by the Free Software Foundation; either version 2.1 of
         * the License, or (at your option) any later version.
         * * ModeShape is distributed in the hope that it will be useful,
         * but WITHOUT ANY WARRANTY; without even the implied warranty of
         * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
         * Lesser General Public License for more details.
         *
         * You should have received a copy of the GNU Lesser General Public
         * License along with this software; if not, write to the Free
         * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA
         * 02110-1301 USA, or see the FSF site: http://www.fsf.org. */
    -->
<plugin name="ModeShape"
    displayName="ModeShape"
    package="org.modeshape.rhq"
    description="Supports management and monitoring of ModeShape"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="urn:xmlns:rhq-plugin"
    xmlns:c="urn:xmlns:rhq-configuration">

    <depends plugin="JBossAS7" useClasses="true" />

    <server name="modeshape" 
        description="ModeShape JCR Engine"
        class="EngineComponent"
        discovery="EngineDiscoveryComponent"
        singleton="true">
        
        <runs-inside>
            <parent-resource-type name="JBossAS7 Standalone Server"
                plugin="JBossAS7" />
        </runs-inside>

        <service name="Repositories"
            description="ModeShape Repositories"
            class="RepositoryComponent"
            discovery="RepositoryDiscoveryComponent">

            <!-- METRICS
              * property: should exactly equal the metric literal in ModeShape
              * category: availability, performance (default), throughput, utilization
              * dataType: measurement (default), trait, calltime
              * displayType: summary, detail (default)
              * measurementType: dynamic (default), trendsup, trendsdown
            -->

            <metric property="node-changes"
                displayName="Changed nodes"
                displayType="summary"
                category="utilization"
                description="The number of nodes that were created, updated or deleted during the window due to session saves, workspace imports, or version checkin calls." />

            <metric property="event-count"
                displayName="Event count"
                displayType="summary"
                category="utilization"
                description="The number of observation events that have been sent to at least one listener." />

            <metric property="event-queue-size"
                displayName="Event queue size"
                displayType="summary"
                category="utilization"
                description="The number of events at the end of the window that have yet to be processed and sent to listeners." />

            <metric property="listener-count"
                displayName="Active listeners"
                displayType="summary"
                category="utilization"
                description="The number of listeners registered during the metrics window." />

            <metric property="open-scoped-lock-count"
                displayName="Open-scoped locks"
                displayType="summary"
                category="utilization"
                description="The number of locks that were held by clients during the window. The values go up or down from one window to the next as clients lock and unlock nodes." />

            <metric property="query-count"
                displayName="Active queries"
                displayType="summary"
                category="utilization"
                description="The number of queries that are executing during the metrics window." />

            <metric property="query-execution-time"
                displayName="Query duration"
                displayType="summary"
                category="utilization"
                description="The amount of time required to execute queries." />

            <metric property="sequenced-count"
                displayName="Sequenced nodes"
                displayType="summary"
                category="utilization"
                description="The number of nodes that were sequenced during the metrics window." />

            <metric property="sequencer-execution-time"
                displayName="Sequencer duration"
                displayType="summary"
                category="utilization"
                description="A measurement of how long sequencers take to run and save changes." />

            <metric property="sequenced-queue-size"
                displayName="Sequencer queue size"
                displayType="summary"
                category="utilization"
                description="The number of nodes at the end of the metrics window that have yet to be sequenced." />

            <metric property="session-count"
                displayName="Active sessions"
                displayType="summary"
                category="utilization"
                description="The number of nodes that were sequenced during the metrics window." />

            <metric property="session-lifetime"
                displayName="Session duration"
                displayType="summary"
                category="utilization"
                description="A measurement of how long sessions are kept open." />

            <metric property="session-saves"
                displayName="Saves"
                displayType="summary"
                category="utilization"
                description="The number of save operations called on sessions during the metrics window." />

            <metric property="session-scoped-lock-count"
                displayName="Session-scoped locks"
                displayType="summary"
                category="utilization"
                description="The number of session-scoped locks that were held by clients during the metrics window. The values go up or down from one window to the next as clients lock and unlock nodes." />

            <metric property="workspace-count"
                displayName="Workspace count"
                displayType="summary"
                category="utilization"
                description="The number of workspaces that exist during the metrics window." />

            <resource-configuration>
                <c:group name="indexing"
                    displayName="Indexing"
                    hiddenByDefault="false">

                    <c:simple-property name="indexing-analyzer-classname"
                        displayName="Indexing Analyzer Classname"
                        description="The fully-qualified name of the Lucene analyzer implementation class"
                        required="false"
                        readOnly="true"
                        default="org.apache.lucene.analysis.standard.StandardAnalyzer"
                        type="string" />

                    <c:simple-property name="indexing-analyzer-module"
                        displayName="Indexing Analyzer Module"
                        description="The name of the module that contains the specified analyzer class"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="indexing-async-max-queue-size"
                        displayName="Indexing ASYNC Max Query Size"
                        description="The maximum size of the queue used for asynchronous indexing"
                        required="false"
                        readOnly="true"
                        default="1"
                        type="integer" />

                    <c:simple-property name="indexing-async-thread-pool-size"
                        displayName="Indexing ASYNC Thread Pool Size"
                        description="The size of the thread pool used for asynchronous indexing"
                        required="false"
                        readOnly="true"
                        default="1"
                        type="integer" />

                    <c:simple-property name="indexing-batch-size"
                        displayName="Indexing Batch Size"
                        description="The size of the indexing batches"
                        required="false"
                        readOnly="true"
                        default="-1"
                        type="integer" />

                    <c:simple-property name="indexing-mode"
                        displayName="Indexing Mode"
                        description="The concurrency mode for indexing"
                        required="false"
                        readOnly="true"
                        default="SYNC"
                        type="string">

                        <c:property-options>
                            <c:option value="SYNC" name="Synchronous Mode" />
                            <c:option value="ASYNC" name="Asynchronous Mode" />
                            <c:option value="DISABLED" name="Disabled Mode" />
                        </c:property-options>
                    </c:simple-property>

                    <c:simple-property name="indexing-reader-strategy"
                        displayName="Indexing Reader Strategy"
                        description="The strategy for sharing (or not sharing) index readers"
                        required="false"
                        readOnly="true"
                        default="SHARED"
                        type="string">

                        <c:property-options>
                            <c:option name="Shared" value="SHARED" />
                            <c:option name="Not Shared" value="NOT_SHARED" />
                        </c:property-options>
                    </c:simple-property>

                    <c:simple-property name="indexing-thread-pool"
                        displayName="Indexing Thread Pool"
                        description="The name of the thread pool that the repository indexing system should use"
                        required="false"
                        readOnly="true"
                        default="modeshape-indexing-workers"
                        type="string" />

                    <c:simple-property name="rebuild-upon-startup"
                        displayName="Rebuild Upon Startup"
                        description="Specifies when (if at all) the indexes should be rebuilt upon repository startup"
                        required="false"
                        readOnly="true"
                        default="IF_MISSING"
                        type="string">

                        <c:property-options>
                            <c:option value="ALWAYS" name="Always" />
                            <c:option value="NEVER" name="Never" />
                            <c:option value="IF_MISSING" name="If Missing" />
                        </c:property-options>
                    </c:simple-property>

                    <c:simple-property name="rebuild-upon-startup-include-system-content"
                        displayName="Rebuild Indexes At Startup"
                        description="Specifies whether the system area should be reindexed or not at startup"
                        required="false"
                        readOnly="true"
                        default="false"
                        type="boolean" />

                    <c:simple-property name="rebuild-upon-startup-mode"
                        displayName="Rebuild Upon Startup Mode"
                        description="ESpecifies whether indexes should be built synchronously or asynchronously on startup"
                        required="false"
                        readOnly="true"
                        default="ASYNC"
                        type="string">

                        <c:property-options>
                            <c:option value="SYNC" name="Synchronous Mode" />
                            <c:option value="ASYNC" name="Asynchronous Mode" />
                            <c:option value="DISABLED" name="Disabled Mode" />
                        </c:property-options>
                    </c:simple-property>

                    <c:simple-property name="system-content-indexing-mode"
                        displayName="System Content Indexing Mode"
                        description="The concurrency mode for indexing system content"
                        required="false"
                        readOnly="true"
                        default="DISABLED"
                        type="string">

                        <c:property-options>
                            <c:option value="SYNC" name="Synchronous Mode" />
                            <c:option value="ASYNC" name="Asynchronous Mode" />
                            <c:option value="DISABLED" name="Disabled Mode" />
                        </c:property-options>
                    </c:simple-property>
                </c:group>

                <c:group name="security"
                    displayName="Security"
                    hiddenByDefault="false">

                    <c:simple-property name="allow-workspace-creation"
                        displayName="Allow Workspace Creation"
                        description="Specifies whether workspaces can be created (and removed) by clients, if those clients are authorized"
                        required="false"
                        readOnly="true"
                        default="true"
                        type="boolean" />

                    <c:list-property name="anonymous-roles"
                        displayName="Anonymous Roles"
                        description="The roles given to all anonymous users for accessing and changing repository content"
                        required="false"
                        readOnly="true">

                        <c:map-property name="roles"
                             description="A collection of anonymous roles"
                             readOnly="true">

                             <c:simple-property name="role"
                                 displayName="Anonymous Role"
                                 description="The roles given to all anonymous users for accessing and changing repository content"
                                 required="true"
                                 readOnly="true" />
                        </c:map-property>
                    </c:list-property>

                    <c:simple-property name="anonymous-username"
                        displayName="Anonymous Username"
                        description="The username that is used for all anonymous users"
                        required="false"
                        readOnly="true"
                        default="&lt;anonymous&gt;"
                        type="string" />

                    <c:simple-property name="security-domain"
                        displayName="Security Domain"
                        description="The name of the security domain used for JAAS authentication and authorization of repository users"
                        required="false"
                        readOnly="true"
                        default="modeshape-security"
                        type="string" />

                    <c:simple-property name="use-anonymous-upon-failed-authentication"
                        displayName="Use Anonymous Login Upon Failed Authentication"
                        description="Specify whether users that fail authentication should be automatically logged in as anonymous users"
                        required="false"
                        readOnly="true"
                        default="false"
                        type="boolean" />
                </c:group>

                <c:group name="general_properties"
                    displayName="General Properties"
                    hiddenByDefault="false">

                    <c:simple-property name="cache-container"
                        displayName="Cache Container"
                        description="The name of the Infinispan cache container that contains the cache to be used for storing this repository's content"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="cache-name"
                        displayName="Cache Name"
                        description="The name of the Infinispan cache that is to be used for storing this repository's content"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="cluster-stack"
                        displayName="JGroups Stack"
                        description="Defines the JGroups stack used by the repository when clustered"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="default-initial-content"
                        displayName="Default Initial Content"
                        description="The path to the initial content file which should be imported by default in all workspaces"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="default-workspace"
                        displayName="Default Workspace Name"
                        description="The name of the workspace that is used when clients don't specify a workspace name"
                        required="false"
                        readOnly="true"
                        default="default"
                        type="string" />

                    <c:simple-property name="enable-monitoring"
                        displayName="Enable Monitoring"
                        description="Enable monitoring of the repository"
                        required="false"
                        readOnly="true"
                        default="true"
                        type="boolean" />

                    <c:simple-property name="enable-queries"
                        displayName="Enable Queries"
                        description="Enable queries, indexing and text extractors"
                        required="false"
                        readOnly="true"
                        default="true"
                        type="boolean" />

                    <c:simple-property name="garbage-collection-initial-time"
                        displayName="Garbage Collection Initial Time"
                        description="The initial local time after starting that garbage collection should first be run"
                        required="false"
                        readOnly="true"
                        default="00:00"
                        type="string" />

                    <c:simple-property name="garbage-collection-interval"
                        displayName="Garbage Collection Interval"
                        description="The number of hours between garbage collection operations"
                        required="false"
                        readOnly="true"
                        default="24"
                        type="integer" />

                    <c:simple-property name="garbage-collection-thread-pool"
                        displayName="Garbage Collection Thread Pool"
                        description="The scheduled thread pool to be used for garbage collection"
                        required="false"
                        readOnly="true"
                        default="modeshape-gc"
                        type="string" />

                    <c:simple-property name="jndi-name"
                        displayName="JNDI Name"
                        description="The optional name in JNDI where this repository is to be registered"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:simple-property name="minimum-binary-size"
                        displayName="Minimum Binary Size"
                        description="The size threshold that dictates whether binary values should be stored in the binary store. Binary values smaller than this value are stored with the node, whereas binary values with a size equal to or greater than this limit will be stored separately from the node and in the binary store, keyed by the SHA-1 hash of the value."
                        required="false"
                        readOnly="true"
                        default="4096"
                        type="integer" />

                    <c:simple-property name="minimum-string-size"
                        displayName="Minimum String Size"
                        description="The size threshold that dictates whether String values should be stored in the binary store. String values smaller than this value are stored with the node, whereas string values with a size equal to or greater than this limit will be stored separately from the node and in the binary store, keyed by the SHA-1 hash of the value."
                        required="false"
                        readOnly="true"
                        type="integer" />

                    <c:list-property name="node-types"
                        displayName="Node Types"
                        description="The list of CND files which should be imported at repository startup"
                        required="false"
                        readOnly="true">

                        <c:map-property name="cnd-files"
                             description="A collection of CND files"
                             readOnly="true">

                             <c:simple-property name="cnd-uri"
                                 displayName="CND URI"
                                 description="The URI of a CND file which should be imported at repository startup"
                                 required="true"
                                 readOnly="true" />
                        </c:map-property>
                    </c:list-property>

                    <c:list-property name="predefined-workspace-names"
                        displayName="Predefined Workspace Names"
                        description="The list of workspace names that exist when the repository is started"
                        required="false"
                        readOnly="true">

                        <c:map-property name="workspace-names"
                             description="A collection of workspace names"
                             readOnly="true">

                             <c:simple-property name="workspace-name"
                                 displayName="Workspace Name"
                                 description="The name of a workspace that exists when the repository is started"
                                 required="true"
                                 readOnly="true" />
                        </c:map-property>
                    </c:list-property>

                    <c:simple-property name="workspaces-cache-container"
                        displayName="Workspace Cache Container"
                        description="Specifies the name of the Infinispan cache container in which the workspace caches will be found"
                        required="false"
                        readOnly="true"
                        type="string" />

                    <c:list-property name="workspaces-initial-content"
                        displayName="Workspaces Initial Content"
                        description="The mapping from the name of a predefined workspace to an initial content file"
                        required="false"
                        readOnly="true">

                        <c:map-property name="content-mappings"
                             description="A collection initial content mappings"
                             readOnly="true">

                             <c:simple-property name="workspace"
                                 displayName="Workspace"
                                 description="The name of the predefined workspace"
                                 required="true"
                                 readOnly="true" />

                             <c:simple-property name="initial-content"
                                 displayName="Content Path"
                                 description="The path to an initial content file"
                                 required="true"
                                 readOnly="true" />
                        </c:map-property>
                    </c:list-property>
                </c:group>
            </resource-configuration>
        </service>

    </server>

</plugin>
